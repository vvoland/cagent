<h1>Tips & Best Practices</h1>
<p class="subtitle">Expert guidance for building effective, efficient, and secure agents.</p>

<h2>Configuration Tips</h2>

<h3>Auto Mode for Quick Start</h3>

<p>Don't have a config file? cagent can automatically detect your available API keys and use an appropriate model:</p>

<pre><code class="language-bash"># Automatically uses the best available provider
cagent run

# Provider priority: OpenAI → Anthropic → Google → Mistral → DMR</code></pre>

<p>The special <code>auto</code> model value also works in configs:</p>

<pre><code class="language-yaml">agents:
  root:
    model: auto  # Uses best available provider
    description: Adaptive assistant
    instruction: You are a helpful assistant.</code></pre>

<h3>Environment Variable Interpolation</h3>

<p>Commands support JavaScript template literal syntax for environment variables:</p>

<pre><code class="language-yaml">agents:
  root:
    model: openai/gpt-4o
    description: Deployment assistant
    instruction: You help with deployments.
    commands:
      # Simple variable
      greet: "Hello ${env.USER}!"
      
      # With default value
      deploy: "Deploy to ${env.ENV || 'staging'}"
      
      # Multiple variables
      release: "Release ${env.PROJECT} v${env.VERSION || '1.0.0'}"</code></pre>

<h3>Model Aliases Are Auto-Pinned</h3>

<p>cagent automatically resolves model aliases to their latest pinned versions. This ensures reproducible behavior:</p>

<pre><code class="language-yaml"># You write:
model: anthropic/claude-sonnet-4-5

# cagent resolves to:
# anthropic/claude-sonnet-4-5-20250929 (or latest available)</code></pre>

<p>To use a specific version, specify it explicitly in your config.</p>

<h2>Performance Tips</h2>

<h3>Defer Tools for Faster Startup</h3>

<p>Large MCP toolsets can slow down agent startup. Use <code>defer</code> to load tools on-demand:</p>

<pre><code class="language-yaml">agents:
  root:
    model: openai/gpt-4o
    description: Multi-tool assistant
    instruction: You have many tools available.
    toolsets:
      - type: mcp
        ref: docker:github-official
      - type: mcp
        ref: docker:slack
      - type: mcp
        ref: docker:linear
    # Load all tools on first use
    defer: true</code></pre>

<p>Or defer specific tools:</p>

<pre><code class="language-yaml">defer:
  - "mcp:github:*"    # Defer GitHub tools
  - "mcp:slack:*"     # Defer Slack tools</code></pre>

<h3>Filter MCP Tools</h3>

<p>Many MCP servers expose dozens of tools. Filter to only what you need:</p>

<pre><code class="language-yaml">toolsets:
  - type: mcp
    ref: docker:github-official
    # Only expose these specific tools
    tools:
      - list_issues
      - create_issue
      - get_pull_request
      - create_pull_request</code></pre>

<p>Fewer tools means faster tool selection and less confusion for the model.</p>

<h3>Set max_iterations</h3>

<p>Always set <code>max_iterations</code> for agents with powerful tools to prevent infinite loops:</p>

<pre><code class="language-yaml">agents:
  developer:
    model: anthropic/claude-sonnet-4-0
    description: Development assistant
    instruction: You are a developer.
    max_iterations: 30  # Reasonable limit for development tasks
    toolsets:
      - type: filesystem
      - type: shell</code></pre>

<p>Typical values: 20-30 for development agents, 10-15 for simple tasks.</p>

<h2>Reliability Tips</h2>

<h3>Use Fallback Models</h3>

<p>Configure fallback models for resilience against provider outages or rate limits:</p>

<pre><code class="language-yaml">agents:
  root:
    model: anthropic/claude-sonnet-4-0
    description: Reliable assistant
    instruction: You are a helpful assistant.
    fallback:
      models:
        # Different provider for resilience
        - openai/gpt-4o
        # Cheaper model as last resort
        - openai/gpt-4o-mini
      retries: 2      # Retry 5xx errors twice
      cooldown: 1m    # Stick with fallback for 1 min after rate limit</code></pre>

<p><strong>Best practices for fallback chains:</strong></p>
<ul>
  <li>Use different providers for true redundancy</li>
  <li>Order by preference (best first)</li>
  <li>Include a cheaper/faster model as last resort</li>
</ul>

<h3>Use Think Tool for Complex Tasks</h3>

<p>The <code>think</code> tool dramatically improves reasoning quality with minimal overhead:</p>

<pre><code class="language-yaml">toolsets:
  - type: think  # Always include for complex agents</code></pre>

<p>The agent uses it as a scratchpad for planning and decision-making.</p>

<h2>Security Tips</h2>

<h3>Use --yolo Mode Carefully</h3>

<p>The <code>--yolo</code> flag auto-approves all tool calls without confirmation:</p>

<pre><code class="language-bash"># Auto-approve everything (use with caution!)
cagent run agent.yaml --yolo</code></pre>

<p><strong>When it's appropriate:</strong></p>
<ul>
  <li>CI/CD pipelines with controlled inputs</li>
  <li>Automated testing</li>
  <li>Agents with only safe, read-only tools</li>
</ul>

<p><strong>When to avoid:</strong></p>
<ul>
  <li>Interactive sessions with untested prompts</li>
  <li>Agents with shell or filesystem write access</li>
  <li>Any situation where unreviewed actions could cause harm</li>
</ul>

<h3>Combine Permissions with Sandbox</h3>

<p>For defense in depth, use both permissions and sandbox mode:</p>

<pre><code class="language-yaml">agents:
  secure_dev:
    model: anthropic/claude-sonnet-4-0
    description: Secure development assistant
    instruction: You are a secure coding assistant.
    toolsets:
      - type: filesystem
      - type: shell
    # Layer 1: Permission controls
    permissions:
      allow:
        - "read_*"
        - "shell:cmd=go*"
        - "shell:cmd=npm*"
      deny:
        - "shell:cmd=sudo*"
        - "shell:cmd=rm*-rf*"
    # Layer 2: Container isolation
    sandbox:
      image: golang:1.23-alpine
      paths:
        - ".:rw"</code></pre>

<h3>Use Hooks for Audit Logging</h3>

<p>Log all tool calls for compliance or debugging:</p>

<pre><code class="language-yaml">agents:
  audited:
    model: openai/gpt-4o
    description: Audited assistant
    instruction: You are a helpful assistant.
    hooks:
      post_tool_use:
        - matcher: "*"
          hooks:
            - type: command
              command: "./scripts/audit-log.sh"</code></pre>

<h2>Multi-Agent Tips</h2>

<h3>Handoffs vs Sub-Agents</h3>

<p>Understand the difference between <code>sub_agents</code> and <code>handoffs</code>:</p>

<div class="cards">
  <div class="card" style="cursor:default;">
    <h3>sub_agents (transfer_task)</h3>
    <p>Delegates task to a child, waits for result, then continues. The parent remains in control.</p>
    <pre style="margin-top:12px"><code class="language-yaml">sub_agents: [researcher, writer]</code></pre>
  </div>
  <div class="card" style="cursor:default;">
    <h3>handoffs (A2A)</h3>
    <p>Transfers control entirely to another agent (possibly remote). One-way handoff.</p>
    <pre style="margin-top:12px"><code class="language-yaml">handoffs:
  - name: specialist
    url: http://...</code></pre>
  </div>
</div>

<h3>Give Sub-Agents Clear Descriptions</h3>

<p>The root agent uses descriptions to decide which sub-agent to delegate to:</p>

<pre><code class="language-yaml">agents:
  root:
    model: anthropic/claude-sonnet-4-0
    description: Technical lead
    instruction: Delegate to specialists based on the task.
    sub_agents: [frontend, backend, devops]

  frontend:
    model: openai/gpt-4o
    # Good: specific and actionable
    description: |
      Frontend specialist. Handles React, TypeScript, CSS, 
      UI components, and browser-related issues.

  backend:
    model: openai/gpt-4o
    # Good: clear domain boundaries
    description: |
      Backend specialist. Handles APIs, databases, 
      server logic, and Go/Python code.

  devops:
    model: openai/gpt-4o
    description: |
      DevOps specialist. Handles CI/CD, Docker, Kubernetes,
      infrastructure, and deployment pipelines.</code></pre>

<h2>Debugging Tips</h2>

<h3>Enable Debug Logging</h3>

<p>Use the <code>--debug</code> flag to see detailed execution logs:</p>

<pre><code class="language-bash"># Default log location: ~/.cagent/cagent.debug.log
cagent run agent.yaml --debug

# Custom log location
cagent run agent.yaml --debug --log-file ./debug.log</code></pre>

<h3>Check Token Usage</h3>

<p>Use the <code>/usage</code> command during a session to see token consumption:</p>

<pre><code class="language-text">/usage

Token Usage:
  Input:  12,456 tokens
  Output:  3,789 tokens
  Total:  16,245 tokens</code></pre>

<h3>Compact Long Sessions</h3>

<p>If a session gets too long, use <code>/compact</code> to summarize and reduce context:</p>

<pre><code class="language-text">/compact

Session compacted. Summary generated and history trimmed.</code></pre>

<h2>More Tips</h2>

<h3>User-Defined Default Model</h3>

<p>Set your preferred default model in <code>~/.config/cagent/config.yaml</code>:</p>

<pre><code class="language-yaml">settings:
  default_model: anthropic/claude-sonnet-4-0</code></pre>

<p>This model is used when you run <code>cagent run</code> without a config file.</p>

<h3>GitHub PR Reviewer Example</h3>

<p>Use cagent as a GitHub Actions PR reviewer:</p>

<pre><code class="language-yaml"># .github/workflows/pr-review.yml
name: PR Review
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run cagent review
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Install cagent
          curl -fsSL https://get.cagent.dev | sh
          
          # Run the review
          cagent exec reviewer.yaml --yolo \
            "Review PR #${{ github.event.pull_request.number }}"</code></pre>

<p>With a simple reviewer agent:</p>

<pre><code class="language-yaml"># reviewer.yaml
agents:
  root:
    model: anthropic/claude-sonnet-4-0
    description: PR reviewer
    instruction: |
      Review pull requests for code quality, bugs, and security issues.
      Be constructive and specific in your feedback.
    toolsets:
      - type: mcp
        ref: docker:github-official
      - type: think</code></pre>
